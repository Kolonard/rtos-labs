# Лабораторная работа №1: Основы работы с FreeRTOS. Виды многозадачности

## Цель работы

Научиться запускать FreeRTOS на платформе Win32, создавать задачи и исследовать поведение планировщика при различных режимах многозадачности и приоритетах задач.

---

## Задачи лабораторной работы

1. **Запуск FreeRTOS**  
   - Собрать и запустить демонстрационный проект FreeRTOS (Win32-порт).  
   - Убедиться, что FreeRTOS корректно стартует и выводит сообщения в консоль.

2. **Создание двух задач с одинаковыми приоритетами**  
   - Создать две простые задачи (`Task1` и `Task2`), которые выводят сообщения в консоль и делают небольшую задержку (`vTaskDelay`) порядка 10мс.

3. **Запуск FreeRTOS с этими задачами в режиме вытесняющей многозадачности**  

   - Настроить FreeRTOS на использование вытесняющей многозадачности (`configUSE_PREEMPTION = 1`).  
   - Наблюдать порядок выполнения задач.
   - Проанализировать, как задачи переключаются друг с другом при вытесняющей многозадачности.

4. **Запуск FreeRTOS с этими задачами в режиме последовательной (кооперативной) многозадачности без вызова `taskYIELD()`**  

   - Настроить FreeRTOS на кооперативный режим (`configUSE_PREEMPTION = 0`).  
   - Наблюдать порядок выполнения задач.
   - Проанализировать, как задачи переключаются друг с другом при кооперативной многозадачности.

5. **Запуск FreeRTOS с этими задачами в режиме последовательной многозадачности с использованием `taskYIELD()`**  
   - Вставить вызовы `taskYIELD()` в задачи.  
   - Наблюдать порядок выполнения задач.
   - Проанализировать, как задачи переключаются друг с другом при кооперативной многозадачности с передачей.

6. **Запуск FreeRTOS с этими задачами в режиме вытесняющей многозадачности с разными приоритетами**  
   - Назначить задачам разные приоритеты.  
   - Наблюдать, как планировщик распределяет время работы между задачами с разными приоритетами.

---

## Отчёт по лабораторной работе

Студенты должны предоставить:

- Собственный исходный код с реализованными задачами;
- Скриншоты или вывод консоли для каждого режима;
- Краткий анализ наблюдаемого поведения планировщика в каждом режиме.

---

## Приложение: Пример кода создания задачи и управление многозадачностью

### Минимальный пример создания задачи
```c
#include "FreeRTOS.h"
#include "task.h"
#include <stdio.h>

#define PRINT_TIMEOUT 10

#define PRINT_TIMEOUT 1000
#define SYMBOL_PRINT_TIMEOUT 10
void PrintTask(void *pvParameters)
{
    const char *text = (const char *)pvParameters;

    for(;;)
    {
        for (size_t i = 0; i < strlen(text); i++)
        {
            putchar(text[i]);
            fflush(stdout);
            vTaskDelay(pdMS_TO_TICKS(SYMBOL_PRINT_TIMEOUT)); 
        }

        printf("\n");
        vTaskDelay(pdMS_TO_TICKS(PRINT_TIMEOUT));
    }
}

int main(void)
{
    // Создаём две задачи с разными текстами
    xTaskCreate(PrintTask, "Task1", 1000, "Task1", 1, NULL);
    xTaskCreate(PrintTask, "Task2", 1000, "Task2", 1, NULL);

    // Запуск планировщика
    vTaskStartScheduler();

    for(;;); // планировщик никогда не вернётся сюда
    return 0;
}
```
---
## Настройка многозадачности в FreeRTOSConfig.h

| Параметр                 | Описание                                                                         | Пример                             |
| ------------------------ | -------------------------------------------------------------------------------- | ---------------------------------- |
| `configUSE_PREEMPTION`   | Включает вытесняющую (1) или кооперативную (0) многозадачность                   | `#define configUSE_PREEMPTION 1`   |
| `configUSE_TIME_SLICING` | Включает равномерное распределение времени между задачами одинакового приоритета | `#define configUSE_TIME_SLICING 1` |
| `configTICK_RATE_HZ`     | Частота тиков планировщика                                                       | `#define configTICK_RATE_HZ 1000`  |
| `configMAX_PRIORITIES`   | Максимальное количество уровней приоритетов задач                                | `#define configMAX_PRIORITIES 5`   |

Примечание: Для кооперативного режима можно использовать taskYIELD() внутри задачи для принудительного переключения.

---

## Объяснение параметров xTaskCreate

| Параметр        | Описание                                                                                                                                    |
| --------------- | ------------------------------------------------------------------------------------------------------------------------------------------- |
| `pvTaskCode`    | Указатель на функцию задачи (`void Task(void *pvParameters)`).                                                                              |
| `pcName`        | Имя задачи для отладки и мониторинга.                                                                                                       |
| `usStackDepth`  | Размер стека задачи в словах (для Win32 обычно достаточно 1000).                                                                            |
| `pvParameters`  | Указатель на данные, передаваемые в задачу (например, строка или структура).                                                                |
| `uxPriority`    | Приоритет задачи (0 = минимальный, чем выше, тем выше приоритет).                                                                           |
| `pxCreatedTask` | Указатель на хэндл задачи (`TaskHandle_t`), можно использовать для управления задачей после создания (например, удалить или приостановить). |
